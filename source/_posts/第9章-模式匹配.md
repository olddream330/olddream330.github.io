---
title: 第9章 模式匹配
date: 2018-08-05 22:00:14
tags: Scala开发快速入门
---
## 9.1 模式匹配简介


```scala211
/**
  * Scala模式匹配
  */
object Example9_01 extends App {
    for (i <- 1 to 5)
    i match {
        case 1 => println(1)
        case 2 => println(2)
        case 3 => println(3)
        case _ => println("others")
    }
}
```


```scala211
/**
  * Scala模式匹配case语句加入表达式
  */
object Example9_02 extends App {
    for (i <- 1 to 6)
    i match {
        case 1 => println(1)
        case x if (x%2==0) => println(s"$x Dividable by 2")
        case _ =>
        }
}
```


```scala211
/**
  * 函数中使用模式匹配
  */
object Example9_03 extends App {
    def patternMatching(x:Int) = x match {
        case 5 => "Int 5"
        case x if (x%2==0) => "divide by 2"
        case _ => "other Int"
    }
    println(patternMatching(5))
    println(patternMatching(4))
    println(patternMatching(3))
}
```

## 9.2 模式匹配的7大类型
- 常量模式：case后面全为常量
- 变量模式
  + `case i =>` 等同于`case _`
- 构造函数模式
- 序列模式
  + `case Array(first, _, three, _*)` `_*`只能放在最后，只能在序列模式使用
- 元组模式
- 类型模式
- 变量绑定模式


```scala211
/**
  * 构造函数模式
  */
object Example9_04 extends App {
    case class Dog(val name:String, val age:Int)
    val dog = Dog("Pet", 2)

    def patternMatching(x:AnyRef) = x match {
        case Dog(name, age) => println(s"Dog name=$name, age=$age")
        case _=>
    }
    patternMatching(dog)
}
```


```scala211
/**
  * 构造函数, 构取对象的部分成员域
  */
object Example9_05 extends App {
    case class Dog(val name:String, val age:Int)
    val dog = Dog("Pet", 2)

    def patternMatching(x:AnyRef) = x match {
        case Dog(_, age) => println(s"Dog age=$age")
        case _=>
    }
    patternMatching(dog)
}
```


```scala211
/**
  * 序列模式
  */
object Example9_06 extends App {
    val arrInt = Array(1,2,3,4)
    def patternMatching(x:AnyRef) = x match {
        case Array(first, second) => println(s"$first,$second")
        case Array(first, _, three, _*) => println(s"$first,$three")
        case _=>
    }
    patternMatching(arrInt)
}
```


```scala211
/**
  * 元组模式
  */
object Example9_07 extends App {
    val tupleInt=(1,2,3,4)
    def patternMatching(x:AnyRef) = x match {
        case (first, second) => println(s"$first,$second")
        case (first,_,three,_) => println(s"$first,$three")
        case _=>
    }
    patternMatching(tupleInt)
}
```


```scala211
/**
  * 类型模式
  */
object Example9_08 extends App {
    class A
    class B extends A
    class C extends A
    val b = new B
    val c = new C
    def patternMatching(x:AnyRef) = x match {
        case x:String => println("String")
        case x:B => println("B")
        case x:A => println("A")
        case _ => println("others")
    }
    patternMatching("Scala")
    patternMatching(b)
    patternMatching(c)
}
```


```scala211
/**
  * 变量绑定模式
  */
object Example9_09 extends App {
    val list = List(List(1,2,3,4),List(4,5,6,7,8,9))
    def patternMatching(x:AnyRef) = x match {
        case e1@List(_, e2@List(4,_*)) => println(e1, e2)
        case _ => 
    }
    patternMatching(list)
}
```

## 9.3 模式匹配原理


```scala211
/**
  * 构造函数模式匹配原理
  * 如果将Dog类定义成普通的类，则不能使用构造函数模式匹配
  * 需要显式定义Dog类的伴生对象并在伴生对象中实现unapply
  * 序列模式匹配原理unapplySeq
  */
object Example9_10 extends App {
    class Dog(val name:String, val age:Int)
    object Dog {
        def unapply(dog:Dog):Option[(String,Int)]={
            if (dog != null) Some(dog.name, dog.age)
            else None
        }
    }

    val dog = new Dog("Pet", 2)

    def patternMatching(x:AnyRef) = x match {
        case Dog(name, age) => println(s"$name, $age")
        case _=>
    }
    patternMatching(dog)
}
```

## 9.4 正则表达式与模式匹配
- Scala方式：
    + val dateP1 = """(\d\d\d\d)-(\d\d)-(\d\d)""".r
    + val dateP2 = new scala.util.matching.Regex("""(\d\d\d\d)-(\d\d)-(\d\d)""")


```scala211
/**
  * 正则表达式（java方式）
  */
object Example9_11 extends App {
    import java.util.regex.Pattern

    val line = "Hadoop has been the most popular big data " +
            "processing tool since 2005-11-21"
    val rgex = "(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)"
    val pattern = Pattern.compile(rgex)
    val m = pattern.matcher(line)
    if (m.find()) {
        println(m.group(0))
        println(m.group(1))
        println(m.group(2))
        println(m.group(3))
    } else {
        println("Not Found")
    }
}
```

### methods


```scala211
val rgex = """(\d\d\d\d)-(\d\d)-(\d\d)""".r
// def findAllIn(source:CharSequence):MatchIterator
for (date <- rgex findAllIn "2015-12-31 2016-02-20") {
    println(date)
}
// def findAllMatchIn(source:CharSequence):Iterator[Match]
for (date <- rgex findAllMatchIn "2015-12-31 2016-02-20") {
    println(date.groupCount)
}
// def findFirstIn(source:CharSequence):Option[String]
val copyright:String = rgex findFirstIn "Date of this document:2011-07-15" match {
    case Some(date) => "Copyright " + date
    case None       => "No copyright"
}
```


```scala211
val dateP2 = new scala.util.matching.Regex("""(\d\d\d\d)-(\d\d)-(\d\d)""","year","month","day")
// def findFirstMatchIn(source:CharSequence):Option[Match]
val result = dateP2 findFirstMatchIn "2015-12-31 2016-02-20" match {
    case Some(m) => "year: " + m.group("year")
    case None    => "No match"
}
// def replaceAllIn(target:CharSequence, replacer:(Match) => String):String
val text = "From 2011-07-15 to 2011-07-17"
val repl = dateP2 replaceAllIn (text, m => m.group("month") + "/" + m.group("day"))
```


```scala211
/**
  * 提取模式的分组值
  */
object Example9_12 extends App {
    val dateRegx = """(\d\d\d\d)-(\d\d)-(\d\d)""".r
    val text = "2015-12-31 2016-02-20"

    for (date <- dateRegx.findAllIn(text)) {
        date match {
            case dateRegx(year, month, day) => println(s"Match $year $month $day")
            case _=>
        }
    }

    for (dateRegx(year, month, day) <- dateRegx.findAllIn(text)) {
        println(s"For match $year $month $day")
    }
}
```


```scala211
/**
  * findFirstMatchIn、findFirstIn与模式匹配
  */
object Example9_13 extends App {
    val dateRegx = """(\d\d\d\d)-(\d\d)-(\d\d)""".r
    val text = "2015-12-31 2016-02-20"

    dateRegx.findFirstMatchIn(text) match {
        case Some(dateRegx(year, month, day)) => println(s"findFirstMatchIn match $year $month $day")
        case None => println("No match")
    }

    dateRegx.findFirstIn(text) match {
        case Some(dateRegx(year, month, day)) => println(s"findFirstIn match $year $month $day")
        case None => println("No match")
    }
}
```

## 9.5 for循环中的模式匹配


```scala211
for (List(first,_*) <- List(List(1,2,3), List(4,5,6,7))) {
    println(s"first is $first")
}
```

## 9.6 模式匹配与样例类、样例对象
- case class 与case object的差异：
    + 在模式匹配时，case class需要先创建对象， case object可直接使用
    + case class生成两个字节码文件，case object生成一个
    + case class生成的伴生对象自动实现apply、unapply，case object不会


```scala211
/**
  * case class与模式匹配
  */
object Example9_14 extends App {
    sealed trait DeployMessage

    case class RegisterWorker(id: String, host:String, port:Int) extends DeployMessage
    case class UnRegisterWorker(id: String, host:String, port:Int) extends DeployMessage
    case class Heartbeat(workerId:String) extends DeployMessage

    def handleMessage(msg: DeployMessage) = msg match {
        case RegisterWorker(id,host,port) => s"The worker $id is registering on $host:$port"
        case UnRegisterWorker(id,host,port) => s"The worker $id is unregistering on $host:$port"
        case Heartbeat(id) => s"The worker $id is sending heartbeat"
    }

    val msgRegister = RegisterWorker("204799", "192.168.1.109", 8079)

    println(handleMessage(msgRegister))
}
```


```scala211
/**
  * case object与模式匹配
  */
object Example9_15 extends App {
    sealed trait DeployMessage

    case class RegisterWorker(id: String, host:String, port:Int) extends DeployMessage
    case class UnRegisterWorker(id: String, host:String, port:Int) extends DeployMessage
    case class Heartbeat(workerId:String) extends DeployMessage
    case object RequestWorkerState extends DeployMessage

    def handleMessage(msg: DeployMessage) = msg match {
        case RegisterWorker(id,host,port) => s"The worker $id is registering on $host:$port"
        case UnRegisterWorker(id,host,port) => s"The worker $id is unregistering on $host:$port"
        case Heartbeat(id) => s"The worker $id is sending heartbeat"
        case RequestWorkerState => "Request Worker State"
    }

    val msgRegister = RegisterWorker("204799", "192.168.1.109", 8079)

    println(handleMessage(msgRegister))
    println(handleMessage(RequestWorkerState))
}
```