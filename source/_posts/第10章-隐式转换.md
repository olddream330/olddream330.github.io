---
title: 第10章 隐式转换
date: 2018-08-05 22:01:21
tags: Scala开发快速入门
---
## 10.1 隐式转换简介

## 10.2 隐式转换函数
> 隐式转换函数与函数名称无关，只与**函数签名**（输入参数类型与返回值类型）有关，如果在当前作用域范围存在函数签名相同但函数名称不同的两个隐式转换函数，则在进行隐式转换时会报错。


```scala211
import scala.language.implicitConversions

implicit def float2int(x:Float)=x.toInt
```




## 10.3 隐式类与隐式对象
- 隐式类的主构造函数参数有且仅有一个


```scala211
implicit class Dog(val name:String) {
    def bark = println(s"$name is barking")
}
"Nacy".bark
```





```scala211
/**
  * 隐式对象(implicitly方法访问隐式对象)
  */
object Example10_1 extends App {
    trait Multiplicable[T] {
        def multiply(x:T):T
    }

    implicit object MultiplicableInt extends Multiplicable[Int] {
        def multiply(x:Int) = x*x
    }

    implicit object MultiplicableString extends Multiplicable[String] {
        def multiply(x:String) = x*2
    }
    /*
    def multiply[T:Multiplicable](x:T) = {
        val ev = implicitly[Multiplicable[T]]
        ev.multiply(x)
    }
    */

    def multiply[T:Multiplicable](x:T)(implicit ev:Multiplicable[T]) = {
        ev.multiply(x)
    }

    println(multiply(5))
    println(multiply("5"))
}
```

## 10.4 隐式参数与隐式值


```scala211
implicit val x:Double = 2.55
def sqrt(implicit x:Double) = Math.sqrt(x)
sqrt
```




```scala211
/**
  * 隐式值（定义普通类）
  */
object Example10_2 extends App {
    trait Multiplicable[T] {
        def multiply(x:T):T
    }

    class MultiplicableInt extends Multiplicable[Int] {
        def multiply(x:Int) = x*x
    }

    class MultiplicableString extends Multiplicable[String] {
        def multiply(x:String) = x*2
    }
    /*
    def multiply[T:Multiplicable](x:T) = {
        val ev = implicitly[Multiplicable[T]]
        ev.multiply(x)
    }
    */

    def multiply[T:Multiplicable](x:T)(implicit ev:Multiplicable[T]) = {
        ev.multiply(x)
    }

    implicit val mInt = new MultiplicableInt

    implicit val mStr = new MultiplicableString

    println(multiply(5))
    println(multiply("5"))
}
```

### 隐式参数使用常见问题

#### 当函数没有柯里化时，implicit会作用于所有参数
```
def product(implicit x:Double,y:Double)=x*y
implicit val d=2.55
product
```

#### 隐式参数使用时不能只指定部分
```
def product(implicit x:Double,y:Double)=x*y
implicit val d=2.55
// 全部不指定
product
// 全部指定
product(2.55,2.55)
```

#### 同类型的隐式值在当前作用域内只能出现一次
```
implicit val d=2.55
```

#### implicit只能出现在参数开头（不合法：def product(x:Double,**implicit** y:Double)=x*y）

#### 合法（柯里化）def product(x:Double)(implicit y:Double)=x*y

#### 柯里化函数的implicit只能作用于最后一个参数

#### implicit在隐式参数中只能出现一次
- 不合法：
    + def product(implicit x:Double,implicit y:Double)=x*y
    + def product(implicit x:Double)(implicit y:Double)=x*y

#### 匿名函数不能使用隐式参数

#### 柯里化如有隐式参数，则不能使用其偏应用函数

## 10.5 隐式转换规则与问题

### 显示定义规则
```
def product(implicit x:Double,y:Double)=x*y
implicit val d:Double=2.55
```

### 作用域规则

### 无歧义规则
- 不能存在多个隐式转换使代码合法

### 一次转换原则
- 从源类型到目标类型只会经过一次转换